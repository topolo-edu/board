<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.goorm.board.mapper.SupplierMapper">

    <!-- SupplierDto ResultMap -->
    <resultMap id="supplierDtoResultMap" type="io.goorm.board.dto.supplier.SupplierDto">
        <id property="supplierSeq" column="supplier_seq"/>
        <result property="name" column="name"/>
        <result property="contactPerson" column="contact_person"/>
        <result property="email" column="email"/>
        <result property="phone" column="phone"/>
        <result property="address" column="address"/>
        <result property="description" column="description"/>
        <result property="isActive" column="is_active"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="createdSeq" column="created_seq"/>
        <result property="updatedSeq" column="updated_seq"/>
    </resultMap>

    <!-- 기본 컬럼 -->
    <sql id="supplierDtoColumns">
        s.supplier_seq, s.name, s.contact_person, s.email, s.phone,
        s.address, s.description, s.is_active,
        s.created_at, s.updated_at, s.created_seq, s.updated_seq
    </sql>

    <!-- 활성 공급업체 목록 조회 -->
    <select id="findAllActive" resultMap="supplierDtoResultMap">
        SELECT <include refid="supplierDtoColumns"/>
        FROM suppliers s
        WHERE s.is_active = true
        ORDER BY s.name ASC
    </select>

    <!-- 활성 공급업체 + 선택된 공급업체 조회 -->
    <select id="findAllActiveOrSelected" resultMap="supplierDtoResultMap">
        SELECT <include refid="supplierDtoColumns"/>
        FROM suppliers s
        WHERE s.is_active = true
        <if test="selectedSupplierSeq != null">
            OR s.supplier_seq = #{selectedSupplierSeq}
        </if>
        ORDER BY s.name ASC
    </select>

</mapper>